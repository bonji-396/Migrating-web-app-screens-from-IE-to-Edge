# 現行システム延命のために、アプリ画面をIEからEdgeへの移行

## プロジェクトの全体像

1. 現状調査: IE 依存部分とシステム構成を把握
2. モード選択: IE モード利用 or モダンブラウザ完全移行を決定
3. 改修: フロントエンド、バックエンドのコードを修正
4. テスト: クロスブラウザ、パフォーマンス、セキュリティテストを実施
5. 移行とサポート: ユーザー対応と運用改善
6. 移行後の運用計画


## ASP.NET を利用しているシステム

ASP.NET を利用しているシステムで、現行システムの延命のためにアプリ画面を Internet Explorer (IE) から Microsoft Edge に移行するプロジェクトを進める場合、主に以下のような作業が必要になります。


### 1. 現行システムの動作確認

目的: どの機能が IE に依存しているか、Edge 上で動作するかを調査。

- HTML/CSS/JavaScript の互換性を確認
   - 古い JavaScript コード（例: `document.all` や `attachEvent`）が使われていないかチェック
   - CSS の古いベンダープレフィックス（`-ms-`）や非推奨のスタイルが使われていないか確認
- ブラウザ固有の API の使用確認
   - `ActiveX` コントロール、`window.external`、`VBScript` など、IE 固有の技術が利用されていないかを調査
- ASP.NET のバージョン確認
   - 古い ASP.NET バージョンでは、HTML や JavaScript が古い仕様で生成されている場合があります


### 2. Microsoft Edge のモード選択

Edge には複数の動作モードがあります。以下から適切なモードを選択します


#### a. Internet Explorer モード（IEモード）

- 特長
   - IE と同等の互換性を提供
   - Edge 内で IE と同様に動作させる
- 対象
   - コードの大幅な改修が困難な場合
   - 一時的に延命措置を取りたい場合
- 対応手順
   1. IEモードの設定
      - Edge の管理ポリシーで IE モードを有効化
      - 必要に応じて、サイトごとの IE モードリストを設定
   2. ユーザーへのガイド
      - IEモードの利用方法や制限事項をドキュメント化


#### b. 標準 Edge モードへの完全移行

- 特長
   - 現代的なブラウザ機能をフル活用
   - セキュリティとパフォーマンスが向上
- 対象
   - IE 固有の依存部分を除去できる場合
   - 長期的な延命や改修を行いたい場合
- 対応手順
   - IE 固有のコードを修正し、モダンなブラウザで動作するよう改修


### 3. コードの改修とテスト

Edge 標準モードで動作させる場合、コード改修が必要になります


#### a. フロントエンド（HTML/CSS/JavaScript）改修

- ActiveX の代替  
`ActiveX` を利用している場合、JavaScript や `WebAssembly`、またはサーバーサイド実装への移行を検討
- 古い JavaScript の置き換え
   - `document.all` → `document.querySelector` や `document.getElementById` に置き換え
   - `attachEvent` → `addEventListener` を使用
- CSS の修正  
ベンダープレフィックス（-ms-）を削除し、標準プロパティに置き換える

#### b. サーバーサイド（ASP.NET）改修

- レンダリングされる HTML がモダンなブラウザで正しく解釈されるか確認
- ASP.NET の WebForms を使用している場合、生成される HTML を手動で調整する必要があるケースもあります
- ASP.NET ViewState など、古いブラウザ向けの依存機能が問題にならないか確認

#### c. サードパーティ製ライブラリの更新

サードパーティ製のコンポーネントやライブラリ（グリッド、カレンダーなど）が古いバージョンの場合、モダンブラウザ対応の最新バージョンに更新

#### d. テスト環境の整備

- クロスブラウザテスト
   - Edge 上で機能が正しく動作することを確認
   - 必要に応じて、Chrome や Firefox などでも確認
- 自動テストの導入
   - Selenium などを利用して、ブラウザ間での動作を検証

### 4. セキュリティの再評価

- TLS  
ASP.NET アプリケーションが最新の`TLS`（1.2 または 1.3）を使用しているか確認
- Cookie 設定  
SameSite 属性の設定やセキュリティヘッダー（`CSP`、`HSTS`）の確認
- `ActiveX` や古い技術の廃止   
`ActiveX` を廃止し、セキュリティリスクを低減

### 5. ユーザー対応

- トレーニングとドキュメント  
Edge への移行ガイドや FAQ を提供
- 新しい機能の教育  
Edge のモダンブラウザ機能（開発者ツール、拡張機能など）の説明

6. 継続的な運用とモニタリング

- ユーザーからのフィードバック収集  
移行後の不具合や要望を迅速に把握
- 定期的なコードレビュー  
モダンなブラウザ仕様への追従を継続的に行う
- 更新スケジュールの策定  
ASP.NET アプリケーションの将来的なフレームワーク更新を計画（例: .NET 6+ への移行）。


## Java ベースのシステム

現行システムが Java を使用しており、Internet Explorer (IE) から Microsoft Edge に移行する場合の対応について、ASP.NET の場合と同様に考えられる作業を整理しました。Java システムの場合も、IE 特有の依存部分を排除し、モダンなブラウザ（Microsoft Edge を含む）で問題なく動作するようにすることが主な目標です。

### 1. 現状分析

Java システムで使用されている技術スタックと機能を確認し、IE 固有の依存部分を特定します。
- フロントエンドの構成確認
   - HTML/CSS/JavaScript がモダンブラウザで動作するか確認
   - Java サーブレットや JSP、JavaScript ライブラリ（jQuery など）のバージョンが古くないかチェック
- IE 固有の技術依存  
`ActiveX`、VBScript、非標準の JavaScript API などが使われていないか確認
- バックエンド技術確認  
サーバー側の技術スタック（JSP、Servlet、Spring MVC など）にブラウザ依存のロジックが含まれていないか確認


### 2. Microsoft Edge への移行方針の決定

Java システムでの移行では以下の選択肢が考えられます。

a. Internet Explorer モード（IE モード）利用

- Edge に組み込まれた IE モードを利用することで、既存のコードを修正せず動作させる方法です。
- 適用例  
   - コードの改修が困難
   - システムの寿命が短く、大幅な更新が不要
- 対応手順
   1. IE モードの設定  
   Edge のグループポリシーやエンタープライズモードサイトリストを設定
   2. 設定のテスト  
   すべての対象ページが IE モードで正しく動作することを確認

b. モダンブラウザへの完全移行

- 現代的なブラウザ（Edge 標準モードや Chrome、Firefox）で動作するよう、フロントエンドやバックエンドのコードを改修
- 適用例  
長期的にシステムを運用する必要がある。
- IE 固有の技術を廃止し、モダンな技術を採用したい。


### 3. フロントエンドの改修

Java システムでは、JSP やサーブレットなどを利用して動的に HTML を生成することが多いです。そのため、フロントエンドの以下の改修を行います。

a. HTML/CSS の確認と修正

- CSS の更新  
ベンダープレフィックス（`-ms-` など）が使われている場合は標準仕様に修正
- レスポンシブデザインへの対応を検討（Flexbox や Grid を活用）
- HTML の非標準タグの確認  
`<bgsound>` や `<marquee>` など、IE 固有の非標準タグが使われていないか確認

b. JavaScript のモダナイズ

- 古い記法の修正
   - `document.all` や `attachEvent` など、IE 固有のコードを削除
   - 標準 API に置き換える（例: `addEventListener`、`fetch`）
- 依存ライブラリの更新  
   - jQuery などの JavaScript ライブラリが使用されている場合、最新バージョンに更新
   - 必要に応じて、モダンなフレームワーク（例: React、Vue.js、Angular）への移行を検討

c. ActiveX の排除

- `ActiveX` を使用している場合、`JavaScript + Web API`、または `WebAssembly` などで代替機能を実装
- 例: ファイル操作やシステム情報取得が ActiveX に依存している場合、サーバーサイド API を利用


### 4. バックエンドの改修

Java システムのバックエンドに以下の改修が必要になる場合があります。

a. サーバーサイド HTML レンダリングの最適化

- JSP、Thymeleaf、Freemarker などのテンプレートエンジンを使用している場合、生成される HTML がモダンブラウザに対応しているか確認
- 必要に応じて、生成される HTML を修正

b. 古い依存技術の排除

- Java アプレット  
Java アプレットが利用されている場合、完全に廃止し、代替技術（Webアプリやクライアントアプリケーション）を検討
- 古いライブラリやフレームワーク  
使用している Spring Framework、Struts などが古い場合、最新バージョンに更新

c. API の提供

- クライアントサイドでの操作を拡張するため、必要に応じて REST API を提供

### 5. クロスブラウザテストの実施

モダンブラウザで問題がないことを確認します。

- ブラウザ互換性テスト  
Microsoft Edge の他、Chrome、Firefox、Safari など主要ブラウザで動作を確認。
- 自動化テスト  
Selenium や Playwright などを利用して、UI 操作の自動テストを実施。
- パフォーマンステスト  
ブラウザの変更によるパフォーマンスの変化を確認。

### 6. セキュリティと運用の見直し

- HTTPS の確認  
HTTPS を強制し、`TLS` 設定が最新か確認。
- セキュリティヘッダーの追加  
`Content Security Policy（CSP）`、`HSTS` などを適用。
- Cookie 設定  
`SameSite` 属性や `Secure` 属性を確認。

### 7. ユーザー対応と移行後のサポート

- エンドユーザーのトレーニング  
Edge の利用方法や注意点をユーザーに周知。
- 移行期間の確保  
IE 依存部分を段階的に廃止し、移行期間を設ける。

